<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:conv="using:FactorioModManager.Views.Converters"
        x:Class="FactorioModManager.Views.VersionHistoryWindow"
        x:CompileBindings="False"
        Title="Version History"
        Width="950" Height="650"
        MinWidth="750" MinHeight="500">

  <Grid RowDefinitions="Auto,*">
    <Border Grid.Row="0" BorderBrush="#333" BorderThickness="0,0,0,1"
            Background="#2B2B2B" Padding="15">
      <TextBlock FontSize="18" FontWeight="Bold" Name="ModTitle" />
    </Border>

    <DataGrid Grid.Row="1"
              Name="VersionGrid"
              ItemsSource="{Binding Releases}"
              AutoGenerateColumns="False"
              CanUserReorderColumns="False"
              CanUserResizeColumns="True"
              GridLinesVisibility="Horizontal"
              IsReadOnly="True">
      <DataGrid.Columns>
        <DataGridTextColumn Header="Version"
                            Binding="{Binding Version}"
                            Width="130" />

        <DataGridTextColumn Header="Released"
                            Binding="{Binding ReleasedAt, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}"
                            Width="160" />

        <DataGridTextColumn Header="Factorio Version"
                            Binding="{Binding FactorioVersion}"
                            Width="150" />

        <DataGridTemplateColumn Header="Action" Width="140">
          <DataGridTemplateColumn.CellTemplate>
            <DataTemplate>
              <StackPanel Orientation="Horizontal" Spacing="5" HorizontalAlignment="Center">
                <!-- âœ… TOGGLE: Download OR Delete based on IsInstalled -->
                <Button Content="{Binding IsInstalled, Converter={x:Static conv:ActionButtonTextConverter.Instance}}"
                        IsEnabled="{Binding CanDeleteOrDownload}"
                        Command="{Binding $parent[Window].DataContext.ActionCommand}"
                        CommandParameter="{Binding}"
                        IsVisible="{Binding !IsInstalling}"
                        Background="{Binding IsInstalled, Converter={x:Static conv:ActionButtonColorConverter.Instance}}"
                        MinWidth="90"
                        HorizontalContentAlignment="Center" />
                <ProgressBar IsVisible="{Binding IsInstalling}"
                             Value="{Binding DownloadProgress}"
                             Maximum="100"
                             MinWidth="90"
                             Height="12" />
              </StackPanel>
            </DataTemplate>
          </DataGridTemplateColumn.CellTemplate>
        </DataGridTemplateColumn>
      </DataGrid.Columns>
    </DataGrid>
  </Grid>
</Window>