<!-- LogWindow.axaml -->
<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:FactorioModManager.ViewModels.Dialogs"
        xmlns:m="using:FactorioModManager.Models"
        x:Class="FactorioModManager.Views.LogWindow"
        x:DataType="vm:LogWindowViewModel"
        Loaded="Window_Loaded"
        Title="Log Viewer"
        Width="900" Height="600">

  <Grid RowDefinitions="Auto,*,Auto">

    <!-- Header -->
    <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
      <TextBlock Text="{Binding LogCountText}"
                 FontSize="14"
                 Margin="10" />

      <StackPanel Grid.Column="1"
                 Orientation="Horizontal"
                 Spacing="5"
                 Margin="10">
        <Button Content="Refresh" Command="{Binding RefreshCommand}" />
        <Button Content="Clear" Command="{Binding ClearLogsCommand}" />
        <Button Content="Archive" Command="{Binding ArchiveLogsCommand}" />
        <Button Content="Open File" Command="{Binding OpenLogFileCommand}" />
      </StackPanel>
    </Grid>

    <!-- Log Content Area -->
    <Grid Grid.Row="1">
      <!-- ✅ Loading State - Controlled by IsLoading -->
      <StackPanel IsVisible="{Binding IsLoading}"
                  VerticalAlignment="Center"
                  HorizontalAlignment="Center"
                  Spacing="15">

        <ProgressBar IsIndeterminate="True"
                     Width="50"
                     Height="50"
                     Foreground="#4CAF50" />

        <TextBlock Text="Loading Logs..."
                   FontSize="16"
                   Foreground="#888"
                   HorizontalAlignment="Center" />
      </StackPanel>

      <!-- ✅ Logs Display -->
      <ScrollViewer IsVisible="{Binding !IsLoading}"
                    x:Name="LogScrollViewer"
                    Background="#1E1E1E">

        <ItemsControl ItemsSource="{Binding Logs}">
          <ItemsControl.ItemTemplate>
            <DataTemplate x:DataType="m:LogEntry">
              <StackPanel Orientation="Horizontal" Margin="5,2">
                <TextBlock Text="{Binding Timestamp}"
                           Foreground="Gray"
                           FontFamily="Consolas" />
                <TextBlock Text="{Binding LevelText}"
                           Foreground="{Binding LevelBrush}"
                           FontWeight="Bold"
                           FontFamily="Consolas"
                           Margin="5,0" />
                <ItemsControl ItemsSource="{Binding MessageSegments}">
                  <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                      <StackPanel Orientation="Horizontal" />
                    </ItemsPanelTemplate>
                  </ItemsControl.ItemsPanel>
                  <ItemsControl.ItemTemplate>
                    <DataTemplate x:DataType="m:MessageSegment">
                      <TextBlock Text="{Binding Text}"
                                 Foreground="{Binding Foreground}"
                                 FontWeight="{Binding Weight}"
                                 FontFamily="Consolas" />
                    </DataTemplate>
                  </ItemsControl.ItemTemplate>
                </ItemsControl>
              </StackPanel>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
      </ScrollViewer>
    </Grid>
  </Grid>
</Window>